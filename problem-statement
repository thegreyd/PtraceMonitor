
CSC 501 Program: Sandbox
Assignment:

Build a simple sandbox using the ptrace system call.
Due:
See home page.
Description

This file has been heavily modified since the original announcement. Here is the diff.

Build fendâ€”a simple sandbox using the ptrace system call. This sandbox guards all access to all files 1 by a program. If an access is disallowed the offending system call will return the EACESS error code.

Invocation:

    fend [-c config] <command [args ...]> 

where config is an optional configuration file and command is the program the is being sandboxed. If the config file option is not given, the program will look for a file named .fendrc first in the current working directory and second in the user's home directory. If none are found, exit with the message "Must provide a config file."

fend is more restrictive then the OS. It will not permit accesses that the OS prohibits.
Configuration file

The configuration file contains one specification per line. Each specification contains a permission and one glob pattern (see wiki and glob(3) man page). The fields are separated by any number of spaces or tabs. The permission is a 3-bit binary digit, representing in order read, write, and execute permissions. See chmod(1). Therefore,

    111 foo.txt

is full permission and

    000 foo.txt

is complete denial.

It is possible that more than one specification matches a given file name. In such a case, the last match is the one that holds. For example, suppose the following two-line configuration file.

    000 /usr/foo/*
    110 /usr/foo/bar

The file "/usr/foo/bar" matches both lines. Therefore, the last line (110) holds. This is useful for denying access to all files in directory except for an enumerated few.

File names presented to the guarded system calls are generally absolute paths. Therefore, globs based on relative paths names (such as "foo" or "../bar") will not work as you may think. Globs, however, do not need to be absolute paths. For example the glob "*/foo" refers to every file named foo regardless of which directory contains it.
No Implicit Restrictions

If no specification matches the file name, then fend will not restrict the access. If you would like fend to restrict access to all files then include the specification

    000 * 

at the top of the config file.

Turn In:
Be sure to turnin all the files needed. Include a Makefile that creates the appropriate files. A appropriate penalty will be assessed if this is not so.

Also, denote any resources used--including other students--in a file named REFERENCES.
Resources

    Relevant man pages: ptrace(2), perror(2), intro(2), fork(2), execve(2), execl(3), sysctl(3), exec(3), glob(3)
    t00sh's github repo

Evaluation

Student programs will be evaluated by "sandboxing" a set of test programs. For example:

    for test in tests; do ./fend -c config test > test.out 2>&1; done

Notes:

    The code will be tested on the VCL image named here.
    Students are not required to monitor calls of child threads (think: pthread_create). No test case will create threads.

Extra Credit:

The ptrace call only traces the calls from the immediate child subprocess. Thus a traced program one can break out of the sandbox by forking a child (grandchild of the tracer). For extra credit, student programs will sandbox all ancestors (child, grandchildren, etc,) from the traced program.

Submit an empty file name EXTRA_CREDIT (i.e., `touch EXTRA_CREDIT`) in order to be graded for the extra credit.

This extra credit assignment is worth 5%.

[1] The term "files" refers to any entity that can be accessed (ie, named) in the file system. This includes but is not limited to files, directories, and links. 